Ti.UI.setBackgroundColor('#000');Ti.include('biz_logic.js');function tableRowCount(tableName){var count=0;var sqlStatement='SELECT COUNT(*) FROM '+tableName;var row=dbMain.execute(sqlStatement);if(row.isValidRow()){count=row.field(0);}
row.close();return count;};var reportData=[{title:'Select Race',hasChild:true,test:'../examples/tab_groups.js'},{title:'Manage Roster',hasChild:true,test:'../examples/window_properties.js'},{title:'Review Checklist',hasChild:true,test:'../examples/window_standalone.js'}];var tabGroup=Ti.UI.createTabGroup();var dbMain;var win1=Ti.UI.createWindow({title:'Home',backgroundColor:'#fff'});var tab1=Ti.UI.createTab({icon:'53-house.png',title:'Home',window:win1});win1.title='';if(Ti.Platform.name=='iPhone OS')
{win1.hideNavBar();}
var versionNumber=Ti.UI.createLabel({top:360,color:'#333333',text:'Version 1.7.1',font:{fontSize:10,fontFamily:'Helvetica Neue'},width:'auto',height:'auto'});var labelTeamName=Ti.UI.createLabel({top:125,color:'white',text:'Team Name Not Selected',font:{fontSize:20,fontFamily:'Helvetica Neue',fontWeight:'bold'},width:'auto',height:'auto'});var labelRaceName=Ti.UI.createLabel({top:155,color:'#333333',text:'Race Not Selected',font:{fontSize:18,fontFamily:'Helvetica Neue'},width:'auto',height:'auto'});var labelRaceDate=Ti.UI.createLabel({top:185,color:'#333333',text:'',font:{fontSize:18,fontFamily:'Helvetica Neue'},width:'auto',height:'auto'});var labelCountDown=Ti.UI.createLabel({top:230,color:'white',text:'',font:{fontSize:14,fontFamily:'Helvetica Neue'},width:'auto',height:'auto'});var tf1=Ti.UI.createTextField({color:'#336699',height:35,top:20,width:250,hintText:'First Name',keyboardType:Ti.UI.KEYBOARD_DEFAULT,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});var tf2=Ti.UI.createTextField({color:'#336699',height:35,top:75,width:250,hintText:'Last Name',keyboardType:Ti.UI.KEYBOARD_DEFAULT,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});var tf3=Ti.UI.createTextField({color:'#336699',height:35,top:130,width:250,hintText:'Email Address',keyboardType:Ti.UI.KEYBOARD_DEFAULT,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});var registerBtn=Ti.UI.createButton({top:190,height:40,width:100,left:50,title:'Register',enabled:true});win1.barColor='black';win1.backgroundImage='home06.png';var win2=Ti.UI.createWindow({url:'setup_view.js',title:'Setup',backgroundColor:'#fff'});var tab2=Ti.UI.createTab({icon:'20-gear2.png',title:'Setup',window:win2});var win3=Ti.UI.createWindow({url:'timer.js',title:'Timer',backgroundImage:'gradientBackground.png'});var tab3=Ti.UI.createTab({icon:'78-stopwatch.png',title:'Timer',window:win3});var win4=Ti.UI.createWindow({url:'reports.js',title:'Reports',backgroundColor:'#fff'});var tab4=Ti.UI.createTab({icon:'17-bar-chart.png',title:'Reports',window:win4});var tableviewReports=Ti.UI.createTableView({data:reportData});win4.add(tableviewReports);var win5=Ti.UI.createWindow({url:'support.js',title:'Help',backgroundColor:'#fff'});var tab5=Ti.UI.createTab({icon:'90-lifebuoy.png',title:'Help',window:win5});tabGroup.addTab(tab1);tabGroup.addTab(tab2);tabGroup.addTab(tab3);tabGroup.addTab(tab4);tabGroup.addTab(tab5);var regAD=Ti.UI.createAlertDialog({title:'RelayManager',message:'Would you like to register this app to receive email updates? We can promise that your personal information will not be shared with third parties.',buttonNames:['Sign Me Up','No, Thanks']});regAD.addEventListener('click',function(e){if(e.index==0){var w=Ti.UI.createWindow({backgroundColor:'777777'});var invalidEmailAddressAlert=Ti.UI.createAlertDialog({title:'Error',message:'The email address you provided was invalid. You will have an opportunity to re-register at a later time.'});var fnLabel=Ti.UI.createLabel({text:'First Name',color:'white',font:{fontSize:14,fontFamily:'Helvetica Neue'},top:30,left:35,width:'auto',height:'auto'});var firstNameTextField=Ti.UI.createTextField({height:35,top:55,left:30,width:240,keyboardType:Ti.UI.KEYBOARD_DEFAULT,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});var lnLabel=Ti.UI.createLabel({text:'Last Name',color:'white',font:{fontSize:14,fontFamily:'Helvetica Neue'},top:105,left:35,width:'auto',height:'auto'});var lastNameTextField=Ti.UI.createTextField({height:35,top:130,left:30,width:240,keyboardType:Ti.UI.KEYBOARD_DEFAULT,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED});var emailLabel=Ti.UI.createLabel({text:'Email Address',color:'white',font:{fontSize:14,fontFamily:'Helvetica Neue'},top:180,left:35,width:'auto',height:'auto'});var emailTextField=Ti.UI.createTextField({height:35,top:205,left:30,width:240,keyboardType:Ti.UI.KEYBOARD_EMAIL,returnKeyType:Ti.UI.RETURNKEY_DEFAULT,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE});var b=Ti.UI.createButton({title:'Register',top:340,width:125,height:30});b.addEventListener('click',function()
{var emailAddress=emailTextField.value;if(validateEmailAddress(emailAddress)){var xhrRegister=Ti.Network.createHTTPClient();xhrRegister.onload=function(){Ti.API.info("onload function for createTeam");try{Ti.API.info(this.responseText);var doc=this.responseXML.documentElement;var elements=doc.getElementsByTagName("row");var myResponseKey=elements.item(0).text;if(myResponseKey.length>4){dbMain.execute('UPDATE settings SET registration_status = 1 WHERE setting_id = 1');}}catch(e){Ti.API.info("b.addEventListener('click',function() error: "+e.error);}};var firstNameValue=firstNameTextField.value;if((firstNameValue==null)||(firstNameValue.length<1)){var atpos=emailAddress.indexOf("@");firstNameValue=emailAddress.substring(0,atpos);}
xhrRegister.open('POST','https://sinequanonsolutions.appspot.com/registration');var registrationData={};registrationData.procid="0";registrationData.sharedsecret=getSharedSecret();registrationData.firstName=firstNameValue;registrationData.lastName=lastNameTextField.value;registrationData.email=emailAddress;registrationData.deviceId=Ti.Platform.macaddress;if(Ti.Network.online==1){xhrRegister.send(registrationData);}else{noNetworkAlert.show();}}else{invalidEmailAddressAlert.show();}
w.close();});w.add(b);w.add(fnLabel);w.add(firstNameTextField);w.add(lnLabel);w.add(lastNameTextField);w.add(emailLabel);w.add(emailTextField);w.open({modal:true,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_COVER_VERTICAL,modalStyle:Ti.UI.iPhone.MODAL_PRESENTATION_FORMSHEET,navBarHidden:true});}else{dbMain.execute('UPDATE settings SET registration_status = -1 WHERE setting_id = 1');}});tabGroup.addEventListener('open',function(e){Ti.include('db_initialization.js');var regRow=dbMain.execute('SELECT registration_status FROM settings WHERE setting_id = 1');var regStatus=1;if(regRow.isValidRow()){regStatus=regRow.field(0);}
regRow.close();if(regStatus==0){regAD.show();}});Ti.include('populate_agegroup_lk.js');Ti.include('populate_set_lk.js');Ti.include('date_functions.js');Ti.include('countdown.js');tabGroup.open();function homescreenSetup(){try{var row=dbMain.execute('SELECT team_name,race_id FROM settings WHERE setting_id = 1');if(row.isValidRow()){var tn=row.field(0);var ri=row.field(1);if(tn!='-1'){labelTeamName.text=tn;}else{labelTeamName.text='Team Name Not Selected';}
if(ri!='-1'){var qRow=dbMain.execute('SELECT race_name,race_date FROM race WHERE race_id = ?',ri);if(qRow.isValidRow()){raceName=qRow.field(0);raceDate=qRow.field(1);labelRaceName.text=raceName;var raceDateStr=getRaceDisplayDate(raceDate);labelRaceDate.text=raceDateStr;Ti.App.Properties.setString('RaceName',raceName);Ti.App.Properties.setInt('RaceId',ri);Ti.App.Properties.setString('RaceDateStr',raceDateStr);}
qRow.close();}else{labelRaceName.text='Race Not Selected';labelRaceDate.text='(Go to Setup Tab to Complete)';}}else{labelTeamName.text='Team Name Not Selected';labelRaceName.text='Race Not Selected';labelRaceDate.text='(Go to Setup tab to complete)';}
row.close();}catch(ex){Ti.API.info('homescreenSetup() exception: '+ex);}
win1.add(labelTeamName);win1.add(labelRaceName);win1.add(labelRaceDate);win1.add(versionNumber);var rst=getRaceStartTime();if(rst>0){assignedStartTime=rst;win1.add(labelCountDown);countDownDisplay();}}
win1.addEventListener('focus',function(e){Ti.API.info('focus event, calling homescreenSetup');homescreenSetup();});Ti.App.addEventListener('close',function(e)
{try{dbMain.close();}catch(ex){Ti.API.info('Shutdown exception: '+ex);}});